/* http://keith-wood.name/more.html
   Text truncation and show more for jQuery v1.0.0.
   Written by Keith Wood (kwood{at}iinet.com.au) May 2010.
   Dual licensed under the GPL (http://dev.jquery.com/browser/trunk/jquery/GPL-LICENSE.txt) and 
   MIT (http://dev.jquery.com/browser/trunk/jquery/MIT-LICENSE.txt) licenses. 
   Please attribute the author if you use it. */
(function($){var m='more';function More(){this._defaults={length:100,leeway:5,wordBreak:false,toggle:true,ellipsisText:'...',moreText:'Show more',lessText:'Show less',onChange:null}}$.extend(More.prototype,{markerClassName:'hasMore',setDefaults:function(a){$.extend(this._defaults,a||{});return this},_attachMore:function(a,b){a=$(a);if(a.hasClass(this.markerClassName)){return}a.addClass(this.markerClassName);var c={settings:$.extend({},this._defaults)};$.data(a[0],m,c);this._changeMore(a,b)},_changeMore:function(d,e,f){d=$(d);if(!d.hasClass(this.markerClassName)){return}e=e||{};if(typeof e=='string'){var g=e;e={};e[g]=f}var h=$.data(d[0],m);$.extend(h.settings,e);d.find('span.more-ellipsis,a.more-link').remove().end().text(d.text());var i=d.text();if(i.length>h.settings.length+h.settings.leeway){var j=h.settings.length;if(h.settings.wordBreak){var k=i.substring(0,h.settings.length+1).replace('\n',' ').match(/^.*\W/m);j=(k?k[0].length-1:j)}var l='<span class="more-showing">'+i.substring(0,j)+'</span><span class="more-ellipsis">'+h.settings.ellipsisText+'</span>'+'<span class="more-hidden">'+i.substring(j)+'</span>'+'<a href="#" class="more-link">'+h.settings.moreText+'</a>';d.empty().append(l).find('a').click(function(a){var b=$(this);var c=b.html()==h.settings.moreText;b.html(c?h.settings.lessText:h.settings.moreText).siblings('span.more-ellipsis,span.more-hidden').toggle();if(!h.settings.toggle){b.remove()}if(h.settings.onChange){h.settings.onChange.apply(d,[c])}a.stopPropagation();return false})}},_destroyMore:function(a){a=$(a);if(!a.hasClass(this.markerClassName)){return}a.removeClass(this.markerClassName).find('span.more-ellipsis,a.more-link').remove().end().text(a.text());$.removeData(a[0],m)},_settingsMore:function(a){var b=$.data(a,m);return b.settings}});var n=['settings'];$.fn.more=function(a){var b=Array.prototype.slice.call(arguments,1);if($.inArray(a,n)>-1){return $.more['_'+a+'More'].apply($.more,[this[0]].concat(b))}return this.each(function(){if(typeof a=='string'){$.more['_'+a+'More'].apply($.more,[this].concat(b))}else{$.more._attachMore(this,a||{})}})};$.more=new More()})(jQuery);