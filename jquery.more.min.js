/* http://keith-wood.name/more.html
   Text truncation and show more for jQuery v1.1.0.
   Written by Keith Wood (kwood{at}iinet.com.au) May 2010.
   Available under the MIT (https://github.com/jquery/jquery/blob/master/MIT-LICENSE.txt) license. 
   Please attribute the author if you use it. */
(function($){function More(){this._defaults={length:100,leeway:5,wordBreak:false,toggle:true,ellipsisText:'...',moreText:'Show more',lessText:'Show less',onChange:null}}$.extend(More.prototype,{markerClassName:'hasMore',propertyName:'more',_ellipsisClass:'more-ellipsis',_linkClass:'more-link',_showingClass:'more-showing',_hiddenClass:'more-hidden',setDefaults:function(a){$.extend(this._defaults,a||{});return this},_attachPlugin:function(a,b){a=$(a);if(a.hasClass(this.markerClassName)){return}var c={options:$.extend({},this._defaults)};a.addClass(this.markerClassName).data(this.propertyName,c);this._optionPlugin(a,b)},_optionPlugin:function(d,e,f){d=$(d);var g=d.data(this.propertyName);if(!e||(typeof e=='string'&&f==null)){var h=e;e=(g||{}).options;return(e&&h?e[h]:e)}if(!d.hasClass(this.markerClassName)){return}e=e||{};if(typeof e=='string'){var h=e;e={};e[h]=f}$.extend(g.options,e);d.find('span.'+this._ellipsisClass+',a.'+this._linkClass).remove().end().text(d.text());var i=d.text();if(i.length>g.options.length+g.options.leeway){var j=g.options.length;if(g.options.wordBreak){var k=i.substring(0,g.options.length+1).replace('\n',' ').match(/^.*\W/m);j=(k?k[0].length-1:j)}var l='<span class="'+this._showingClass+'">'+i.substring(0,j)+'</span><span class="'+this._ellipsisClass+'">'+g.options.ellipsisText+'</span>'+'<span class="'+this._hiddenClass+'">'+i.substring(j)+'</span>'+'<a href="#" class="'+this._linkClass+'">'+g.options.moreText+'</a>';d.empty().append(l).find('a').click(function(a){var b=$(this);var c=b.html()==g.options.moreText;b.html(c?g.options.lessText:g.options.moreText).siblings('span.'+n._ellipsisClass+',span.'+n._hiddenClass).toggle();if(!g.options.toggle){b.remove()}if($.isFunction(g.options.onChange)){g.options.onChange.apply(d,[c])}a.stopPropagation();return false})}},_destroyPlugin:function(a){a=$(a);if(!a.hasClass(this.markerClassName)){return}a.removeClass(this.markerClassName).removeData(this.propertyName).find('span.'+this._ellipsisClass+',a.'+this._linkClass).remove().end().text(a.text())}});var m=[''];function isNotChained(a,b){if(a=='option'&&(b.length==0||(b.length==1&&typeof b[0]=='string'))){return true}return $.inArray(a,m)>-1}$.fn.more=function(a){var b=Array.prototype.slice.call(arguments,1);if(isNotChained(a,b)){return n['_'+a+'Plugin'].apply(n,[this[0]].concat(b))}return this.each(function(){if(typeof a=='string'){if(!n['_'+a+'Plugin']){throw'Unknown command: '+a;}n['_'+a+'Plugin'].apply(n,[this].concat(b))}else{n._attachPlugin(this,a||{})}})};var n=$.more=new More()})(jQuery);