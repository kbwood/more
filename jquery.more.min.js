/* http://keith-wood.name/more.html
   Text truncation and show more for jQuery v2.0.0.
   Written by Keith Wood (kwood{at}iinet.com.au) May 2010.
   Available under the MIT (https://github.com/jquery/jquery/blob/master/MIT-LICENSE.txt) license. 
   Please attribute the author if you use it. */
(function($){var o='more';$.JQPlugin.createPlugin({name:o,defaultOptions:{length:100,leeway:5,wordBreak:false,ignoreTags:['br','hr','img'],toggle:true,ellipsisText:'...',moreText:'Show more',lessText:'Show less',onChange:null},_ellipsisClass:o+'-ellipsis',_linkClass:o+'-link',_hiddenClass:o+'-hidden',_tagName:/^<(\w+).*>$/,_instSettings:function(a,b){return{html:a.html()}},_optionsChanged:function(d,e,f){var g=this;$.extend(e.options,f);this._preDestroy(d,e);if(d.text().length>e.options.length+e.options.leeway){var h=d.html().match(/(<[^>]+>)|([^<]+)/g);var i=0;var j=0;var k=[];for(;i<h.length;i++){if(h[i][0]==='<'){if(h[i][1]==='/'||h[i][h[i].length-2]==='/'){k.pop()}else if($.inArray(h[i].toLowerCase().replace(this._tagName,'$1'),e.options.ignoreTags)===-1){k.push(h[i])}}else if(j+h[i].length>e.options.length){break}else{j+=h[i].length}}j=e.options.length-j;if(e.options.wordBreak){var l=h[i].substring(0,j+1).replace('\n',' ').match(/^.*\W/m);j=(l?l[0].length-1:j)}var m=function(a){var b='';for(var i=a.length-1;i>=0;i--){b+='</'+a[i].replace(g._tagName,'$1')+'>'}return b};var n=h.slice(0,i).join('')+h[i].substring(0,j)+m(k)+'<span class="'+this._ellipsisClass+'">'+e.options.ellipsisText+'</span>'+'<span class="'+this._hiddenClass+'">'+k.join('')+h[i].substring(j)+m(k)+h.slice(i+1).join('')+'</span>'+'<a href="#" class="'+this._linkClass+'">'+e.options.moreText+'</a>';d.html(n).find('a.'+this._linkClass).click(function(a){var b=$(this);var c=b.html()===e.options.moreText;b.html(c?e.options.lessText:e.options.moreText).siblings('span.'+g._ellipsisClass+',span.'+g._hiddenClass).toggle();if(!e.options.toggle){b.remove()}if($.isFunction(e.options.onChange)){e.options.onChange.apply(d,[c])}a.stopPropagation();return false})}},_preDestroy:function(a,b){a.html(b.html)}})})(jQuery);